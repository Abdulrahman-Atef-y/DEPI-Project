@model IEnumerable<Data_Access_Layer.Entities.Booking>
@{
    ViewData["Title"] = "إدارة الحجوزات";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    var startDateQuery = Context.Request.Query["startDate"].ToString();
    var endDateQuery = Context.Request.Query["endDate"].ToString();
    var roomIdQuery = Context.Request.Query["roomId"].ToString();
}
<link rel="stylesheet" href="~/css/admin-room.css" asp-append-version="true" />
<div class="admin-index-root">
    <div class="admin-header">
        <h2 class="admin-title"><i class="fas fa-calendar-alt"></i> إدارة الحجوزات</h2>
    </div>
     <form method="get" class="mb-3" style="display:flex; gap:10px; flex-wrap:wrap;">
        <div>
            <label>من تاريخ:</label>
            <input type="date" name="startDate" class="form-control" value="@startDateQuery" />
        </div>
        <div>
            <label>إلى تاريخ:</label>
            <input type="date" name="endDate" class="form-control" value="@endDateQuery" />
        </div>
        <div>
            <label>الغرفة:</label>
            <select name="roomId" class="form-control">
                <option value="">جميع الغرف</option>
                @foreach (var room in ViewBag.Rooms)
                {
                    var isSelected = roomIdQuery == room.Id.ToString() ? "selected" : "";
        @: <option value="@room.Id" @isSelected>@room.RoomNumber</option>
                }
            </select>
        </div>
        <div style="align-self:flex-end;">
            <button type="submit" class="admin-create-btn"><i class="fas fa-filter"></i> فلترة</button>
        </div>
    </form>
    <div class="admin-table-wrapper">
        <div class="admin-table-container">
            <table class="table admin-table">
        <thead>
            <tr>
                <th>رقم الحجز</th>
                <th>العميل</th>
                <th>الغرفة</th>
                <th>التاريخ</th>
                <th>المجموع</th>
                <th>الحالة</th>
                <th>إجراءات</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr>
                    <td>#BK-@item.Id</td>
                    <td>@item.Guest.FirstName @item.Guest.LastName</td>
                    <td>@item.Room.RoomNumber</td>
                    <td>@item.CheckInDate.ToShortDateString()</td>
                    <td>@item.TotalPrice.ToString("C0")</td>
                    <td>
                       <span class="booking-status @(item.Status.ToLower())">
						@(
							item.Status == "Pending" ? "قيد الانتظار" :
							item.Status == "Confirmed" ? "مؤكد" :
							item.Status == "Cancelled" ? "ملغي" : "غير معروف"
							)</span>
                    </td>
                            <td class="admin-action-group">
                            <a asp-action="ChangeStatus" asp-route-id="@item.Id" asp-route-status="Confirmed" class="admin-action-btn admin-edit" style="text-decoration:none">تأكيد</a>
                        <form asp-action="Cancel" asp-route-id="@item.Id" method="post"
                              onsubmit="return confirm('هل أنت متأكد من إلغاء هذا الحجز؟');"
                                      style="display:inline;">
                                    <button type="submit" class="admin-action-btn admin-cancel">
                                إلغاء
                            </button>
                        </form>
                                <form asp-action="Delete" asp-route-id="@item.Id" method="post"
                                      onsubmit="return confirm('هل أنت متأكد من حذف هذا الحجز نهائياً؟');"
                                      style="display:inline;">
                                    <button type="submit" class="admin-action-btn admin-delete">
                                        حذف
                                    </button>
                                </form>

                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>